<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-10-24 Sun 21:23 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SoftRock</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Todd Doucet" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">SoftRock</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org00cc045">Construction</a></li>
<li><a href="#org5942682">Circuit</a></li>
<li><a href="#orgd00a96d">Reading</a></li>
<li><a href="#org7cbe8fa">Plans</a></li>
</ul>
</div>
</div>
<p>
Tony Parks at <a href="http://fivedash.com">Five Dash</a> sells a wonderful software-defined radio kit, the SoftRock Ensemble II RX.
I enjoyed building it and then analyzing in some depth the design of several aspects of the radio.
</p>

<div id="outline-container-org00cc045" class="outline-2">
<h2 id="org00cc045">Construction</h2>
<div class="outline-text-2" id="text-org00cc045">
<p>
It is not too difficult to build.  The toroids took me a while, but I enjoyed doing them
and also enjoyed doing the three broadband transformers on the bobbins.  It's nice to know
that you can do all the inductance you need yourself for HF.
</p>

<p>
There are about 18 surface mount bypass capacitors on the bottom of the board, which are pretty
easy to do with only a little practice.  Most of the ICs are also surface mount.  Most are also
easy, but a couple are tricky&#x2014;the very small 3.3-volt regulator caused me the most trouble.  But
there were no serious problems with them and it is a skill well worth developing.
</p>

<p>
The rest of the parts are all through hole and easy to solder.  The part placement is surprisingly
tight, especially in the filter section.  Most of the resistors are small 1/6-watt units and all
resistors are mounted vertically.
</p>

<p>
I found the quality of the circuit board, the parts, and the selection of parts to be very
impressive.  I also like that there is not a polarized capacitor anywhere on the board.
</p>


<div id="org5d85f5b" class="figure">
<p><img src="./docs/01-front.jpg" alt="01-front.jpg" width="100%" />
</p>
</div>


<div id="org881afd1" class="figure">
<p><img src="./docs/02-top.jpg" alt="02-top.jpg" width="100%" />
</p>
</div>


<div id="orga06f5ac" class="figure">
<p><img src="./docs/03-bottom.jpg" alt="03-bottom.jpg" width="100%" />
</p>
</div>
</div>
</div>

<div id="outline-container-org5942682" class="outline-2">
<h2 id="org5942682">Circuit</h2>
<div class="outline-text-2" id="text-org5942682">
<p>
Tony has a perfectly good schematic on <a href="http://fivedash.com">his site</a>, but I decided to take this
opportunity to learn <a href="https://www.kicad.org">KiCad</a>.  So I installed it, went through the tutorials, then learned
how to use the schematic editor to enter the schematic for this radio.  The project
is available in this <a href="https://github.com/ttdoucet/softrock-schematic">repo</a>, and here is a <a href="./docs/softrock-bw.pdf">PDF</a> of the resulting schematic.
</p>

<p>
The heart of the radio is the quadrature sampling detector.  In the circuit snippet immediately below,
the QSD is formed by the operation of the multiplexer U10 and the sampling capacitors C20 and C21, in
conjunction with the op amp gain and low-pass filter stage.
</p>


<div id="orgc5f6b78" class="figure">
<p><img src="./docs/QSD.png" alt="QSD.png" width="100%" />
</p>
</div>

<p>
The circuit is subtle and clever.  RF from the filtered 50-ohm system comes in at the
left of transformer T3, and is transformed down to 12.5 ohms by the 2-to-1 transformer.
It then passes through either one of the 10-ohm resistors R26 or R25, depending on which
branch of switch U10 is closed at that moment, and then it goes to either the top or
bottom sampling capacitor, again depending on which switch is closed at that moment.
</p>

<p>
At each moment, one and only one path conducts through U10.
The QSD clock signals at S0 and S1 cause the multiplexer to close one
contact at a time in the following sequence: top of T3 to top
capacitor C20, then top of T3 to bottom capacitor C21, then bottom of
T3 to the top capacitor, then bottom of T3 to the bottom capacitor.
</p>

<p>
If the input is a sinusoid at a given frequency and the radio is to be tuned
exactly to that center frequency, the local oscillator operates at four
times this center frequency, so that one cycle of the desired signal is
sampled four times, in the manner just described.
</p>

<p>
If the top cap C20 sees the first peak, say, of the sinewave, then it
will see it again half a cycle later, this time from the bottom half
of T3.  Because of the center tap and biasing, these two quarters do not cancel,
they reinforce.  Similarly, in this situation the bottom cap C21 would
see the two zeros of the sinusoid, again additively.  In this case,
the two outputs would converge in a few cycles to DC values for the
two "I" and "Q" outputs of the detector.
</p>

<p>
If the signal is 1 kHz away from the center frequency, say, then the I and Q
outputs would be 1-kHz sinusoids, ninety-degrees out of phase ("in quadrature").
</p>

<p>
In order to check my understanding and to see exactly what is happening at
the sampling capacitors C20 and C21, I created a <a href="https://nbviewer.jupyter.org/github/ttdoucet/qsd-mixer/blob/master/mixer_nb.ipynb">Python notebook</a> to analyze the circuit.
</p>


<div id="org4be91e1" class="figure">
<p><img src="./docs/qsd-nb-1.png" alt="qsd-nb-1.png" />
</p>
</div>

<p>
It traces the voltage at the sampling capacitors by applying first principles,
the differential equations that describe the non-linear commutating RC circuit,
fed by a voltage source with the above-indicated impedances.  The code ended
up being pretty simple and it worked out well, and was a lot of fun.
</p>


<div id="org59b1db9" class="figure">
<p><img src="./docs/qsd-nb-2.png" alt="qsd-nb-2.png" />
</p>
</div>

<p>
The notebook shows the I &amp; Q signals in quadrature, as expected, and also the small
amount of RF ripple present on them (which would be further attenuated
by the low-pass filter of the op amp gain stage).  It also shows the transient
responses and settling time for the circuit.  I was able to analyze
the approximate bandwidth of the sampling system directly, which can be a little
tricky in a nonlinear circuit.  The notebook also investigates how the QSD
behaves when the LO is operated at 1/3 the normal frequency, which is done
sometimes.  (I believe Tony's SoftRock Lite kits do this.)
</p>

<p>
There is also a <a href="https://nbviewer.jupyter.org/github/ttdoucet/impedance/blob/master/impedance.ipynb">second Python Notebook</a> to analyze the bandpass filters
used in the receiver front end.
</p>

<p>
I encourage you to clone the repos and run them for yourself if you're interested&#x2014;lots
of fun!
</p>
</div>
</div>

<div id="outline-container-orgd00a96d" class="outline-2">
<h2 id="orgd00a96d">Reading</h2>
<div class="outline-text-2" id="text-orgd00a96d">
<p>
To gain more insight into how a quadrature detector works, it is worthwhile to
read the informative <a href="./docs/US6230000.pdf">patent document</a> for the Tayloe detector, now
expired.  Additional insight can be had by reading this often-cited but
very hard to find Motorola app note, <a href="./docs/AN-534.pdf">AN-534</a>, Commutating Filter Techniques.
</p>
</div>
</div>

<div id="outline-container-org7cbe8fa" class="outline-2">
<h2 id="org7cbe8fa">Plans</h2>
<div class="outline-text-2" id="text-org7cbe8fa">
<p>
One reason I learned KiCad and did the schematic of the radio is that that, ultimately,
I'd like to investigate variations on this circuit.  I plan to learn the PC board layout
part of KiCad, and then do a board spin on a simplified version of the circuit, which I could
then build and experiment with.  If that comes to pass I will update this page.
</p>

<p>
Todd, AE3K
</p>
</div>
</div>
</div>
</body>
</html>
